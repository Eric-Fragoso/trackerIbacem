<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400, 500, 600, 700, 800, 900" rel="stylesheet">
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/ibacemj.css">
        <link rel="stylesheet" type="text/css" href="css/all.css" >
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

        
        
        <script src="js/jquery.dynatable.js"></script>
        <link rel="stylesheet" type="text/css" href="js/beanstalk.css">
        <link rel="stylesheet" type="text/css" href="js/jquery.dynatable.css">
        <script src="js/jquery.mask.min.js"></script>
        <script src="js/all.js"></script>

        
        <link rel="stylesheet" type="text/css" href="js/jquery.dm-uploader.min.css">


        <link href="js/datepicker.css" rel="stylesheet" type="text/css">
        <script src="js/datepicker.js"></script>
        <script src="js/datepicker.pt-BR.js"></script>




        <title>IBACEM - Sistema de Gerenciamento de Controles e Usuários</title>
        <meta charset="UTF-8">

    </head>
    <body>
        <!-- MODAL DELETAR REGISTRO -->
        <!-- MODAL DELETAR REGISTRO -->
        <!-- MODAL DELETAR REGISTRO -->
        <div id="ModalDeleteRegistro" class="modal">
            <span class="close cursor" onclick="closeModalDeleteRegistro();">&times;</span>
            <div class="modal-content2">
                <h2>CONFIRMAR AÇÃO</h2>
                <p>Deseja realmente deletar esta entrada financeira?<b> Essa ação não poderá ser desfeita</b></p>
                 <button id="confirmarDelete">SIM</button> <button class="cancelarDelete" onclick="closeModalDeleteRegistro();">CANCELAR</button>
                <br clear="all">
            </div>
        </div>
        <!--MODAL CONFIRMAR IMPORT-->
        <!--MODAL CONFIRMAR IMPORT-->
        <!--MODAL CONFIRMAR IMPORT-->
        <div id="ModalConfirmarImport" class="modal">
          <span class="close cursor" onclick="closeModalExibeImportacao();">&times;</span>
          <div class="modal-content3">
              <h2>CONFIRMAR IMPORTAÇÃO</h2>
              <div id="containerControles">
                  <ul>
                    <li>COD_FORNECEDOR: <span id="controleCOD" class="destacaImport">2</span></li>
                    <li>ANO: <span id="controleANO" class="destacaImport">2018</span></li>
                    <li>MÊS: <span id="controleMES" class="destacaImport">11</span></li>
                    <li>SEMANA: <span id="controleSEMANA" class="destacaImport">44</span></li>
                    <li>DATA: <span id="controleDATA" class="destacaImport">01/11/2018</span></li>
                    <li>CULTURA: <span id="controleCULTURA" class="destacaImport">Manga</span></li>
                    <li>VARIEDADE: <span id="controleVAR" class="destacaImport">TOMMY ATKINS</span></li>
                    <li>CONTROLE: <span id="controleCON" class="destacaImport">946</span></li>
                    <li>SAFRA: <span id="controleSAFRA" class="destacaImport">M18</span></li>
                    <li>VOLUME EM KG: <span id="controleCOD" class="destacaImport">8990</span></li>
                  </ul>
              </div>
               <button id="confirmarImport" onclick="salvaControle();">SIM</button> <button class="cancelarDelete" onclick="closeModalExibeImportacao();">CANCELAR</button>
              <br clear="all">
          </div>
      </div>


        <!--MODAL VIEW CONTROLE-->
        <!--MODAL VIEW CONTROLE-->
        <!--MODAL VIEW CONTROLE-->
        <div id="ModalViewControle" class="modal">
          <span class="close cursor" onclick="closeModalViewControle();">&times;</span>
          <div class="modal-content5">
              <h2>DETALHES DO CONTROLE</h2>
              <div id="viewRecepcao" class="containerControles3">
                  <ul>
                    <li>CONTROLE: <span id="controleViewCON" class="destacaImport">2</span></li>
                    <li>FORNECEDOR: <span id="controleViewCOD" class="destacaImport">2</span></li>
                    <li>CULTURA: <span id="controleViewCULTURA" class="destacaImport">2018</span></li>
                    <li>VARIEDADE: <span id="controleViewVARIEDADE" class="destacaImport">11</span></li>
                    <li>VOLUME TOTAL: <span id="controleViewKG" class="destacaImport">44</span></li>
                  </ul>
              </div>
              <div id="viewSelecao" class="containerControles3">
                  <ul>
                    <li>CONTROLE: <span id="controleViewCON" class="destacaImport">2</span></li>
                    <li>FORNECEDOR: <span id="controleViewCOD" class="destacaImport">2</span></li>
                    <li>CALIBRES: <span id="controleViewCALIBRE" class="destacaImport">2018</span></li>
                    <li>VARIEDADE: <span id="controleViewVARIEDADE" class="destacaImport">11</span></li>
                    <li>KG/MERCADO: <span id="controleViewKGMERCADO" class="destacaImport">44</span></li>
                  </ul>                  
                  
              </div>

              <div id="viewEmbalamento" class="containerControles3">
                  <ul>
                    <li>CONTROLE: <span id="controleViewCON" class="destacaImport">2</span></li>
                    <li>FORNECEDOR: <span id="controleViewCOD" class="destacaImport">2</span></li>
                    <li>CALIBRES: <span id="controleViewCALIBRE" class="destacaImport">2018</span></li>
                    <li>REFUGO: <span id="controleViewREFUGO" class="destacaImport">11</span></li>
                    <li>PESO TOTAL: <span id="controleViewKG" class="destacaImport">44</span></li>
                  </ul>
              </div>
              <div id="viewExpedicao" class="containerControles3">
                  <ul>
                    <li>CONTROLE: <span id="controleViewCON" class="destacaImport">2</span></li>
                    <li>CARREGAMENTO: <span id="controleViewCOD" class="destacaImport">2</span></li>
                    <li>CAIXA/MERCADO: <span id="controleViewCXMERCADO" class="destacaImport">2018</span></li>
                    <li>PESO TOTAL: <span id="controleViewKG" class="destacaImport">44</span></li>
                  </ul>
              </div>
              <div id="viewComercial" class="containerControles3">
                  <ul>
                    <li>VER PDF: <span id="controleViewCON" class="destacaImport">2</span></li>
                  </ul>
              </div>
              <button class="cancelarDelete" onclick="closeModalViewControle();">FECHAR</button>
            <br clear="all">
          </div>
      </div>

        <!--MODAL COMENTÁRIO-->
        <!--MODAL COMENTÁRIO-->
        <!--MODAL COMENTÁRIO-->
        <div id="ModalComentario" class="modal">
          <span class="close cursor" onclick="closeModalComentario();">&times;</span>
          <div class="modal-content4">
              <h2>ADICIONAR COMENTÁRIO</h2>
              <div id="containerControles2" style="height: 290px;">
                  <p></p>
                  <textarea placeholder="DIGITE SEU COMENTÁRIO" id="comentario-Controle" readOnly = true></textarea>
                  <ul id="dadosComentario">
                    <li>FORNECEDOR: <span id="controleCODcmt" class="destacaImport">2</span></li>
                    <li>CONTROLE: <span id="controleCONcmt" class="destacaImport">946</span></li>
                    <li>CULTURA: <span id="controleCULTURAcmt" class="destacaImport">Manga</span></li>
                    <li>SAFRA: <span id="controleSAFRAcmt" class="destacaImport">M18</span></li>
                  </ul>
              </div>
              
               <button class="cancelarDelete" onclick="closeModalComentario();">Fechar</button>
              <br clear="all">
          </div>
      </div>



        <header>
            <div class="wrapper">
                <h1>Ibacem</h1>
                <div id="userInfo">
                    
                    <p>Olá, <span id="userName"></span></p>
                    <a id="logoff" href="index.html">SAIR</a>

                    <h2 class="hidden">EXTRATO FINANCEIRO</h2>
                </div>
            </div>
        </header>
        <div id="menuHolder" >
            <div id="abas">
                <button class="tablinks" onclick="openCity(event, 'pageControlesAnalista')" id="default">CONTROLES</button>
                <button class="tablinks" onclick="openCity(event, 'pageFinanceiroAnalista')" id="abaFinan">FINANCEIRO</button>
                <button class="tablinks" onclick="openCity(event, 'pageQualidadeAnalista')"id="abaQuali">QUALIDADE</button>
            </div>
        </div>


        <div class="wrapper">
            <div id="pageControlesAnalista" class="conteudoAba">
                <div id="importDataArea">
                  <h2>IMPORTAR CONTROLE</h2>
                  <input id="input-controle" type="text" placeholder="CONTROLE" value="">
                  
                  <select name="ano-safra" id="select-ano-safra">
                      <option value="" data-placeholder>ANO</option>
                      <option value="17">2017</option>
                      <option value="18">2018</option>
                      <option value="19">2019</option>
                  </select>
                  <select name="cultura" id="select-cultura">
                      <option value="" data-placeholder>CULTURA</option>
                      <option value="M">Manga</option>
                      <option value="U">Uva</option>
                      <option value="C">Cacau</option>
                  </select>
                  <select name="status" id="select-status">
                      <option value="" data-placeholder>STATUS</option>
                      <option value="Recepcao">Recepção</option>
                      <option value="Selecao">Seleção</option>
                      <option value="Embalagem">Embalagem</option>
                      <option value="Expedicao">Expedição</option>
                      <option value="Comercial">Comercial</option>
                  </select>
                  <button class="importDataControles" onclick="erroImport();"><i class="fas fa-plus-circle"></i> IMPORTAR</button>
                  <p id="erroImportData"></p>
              </div>
              <div id="pesquisaControle">
                  <h2>FILTRAR POR EMPRESA</h2>
                  <select name="acesso" id="select-empresa-controle" onchange="filtraEmpresaControle();">
                      <option value="" data-placeholder>EMPRESA</option>
                  </select>
                  <button class="confirmarPesquisa" onclick="filtraEmpresaControle();">FILTRAR</button>
              </div>
              <div class="tableHolder">
                  <table id="my-table" class="table tControles">
                    <thead>
                      <tr>
                        <th >Controle</th>
                        <th >Importação</th>
                        <th >Status</th>
                        <th >Importador</th>
                        <th >Supervisor</th>
                        <th >Analisado</th>
                        <th >Comentário</th>
                        <th >Visualizar</th>
                        <th >Excluir</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-controles">
                    </tbody>
                  </table>
              </div>
            </div>



            <div id="pageFinanceiroAnalista" class="conteudoAba">
              
              <div id="pesquisaFinanceira">
                <h2>FILTRAR POR EMPRESA</h2>
                <select name="acesso" id="select-empresa-financeiro" onchange="filtraEmpresa();">
                    <option value="" data-placeholder>EMPRESA</option>
                </select>
                <button class="confirmarPesquisa" onclick="filtraEmpresa();">FILTRAR</button>
              </div>
              <div id="entradaFinanceira" class="hidden">
                  <h2 id="titleFinanceiro">INSERIR</h2><a class="hidden" id="cancelaEdicao" href="javascript:;" onclick="limpaEditaFinanceiro();">CANCELAR EDIÇÃO</a>
                  <form id="formEntFinanceira" >
                    <input id="input-data" type="text" placeholder="DATA" value="" class="datepicker-here" data-language='pt-BR'>
                    <input id="input-descricao" type="text" placeholder="DESCRIÇÃO" value="">
                    <input id="input-valor" type="text" placeholder="VALOR" value="">
                    <input id="input-nf" type="text" placeholder="Nº N.F." value="">
                    <select name="tipo-entrada" id="select-tipo-entrada">
                        <option value="x" data-placeholder >MOVIMENTO</option>
                        <option value=" ">CRÉDITO</option>
                        <option value="-">DÉBITO</option>
                    </select>
                    <a href="javascript:;" id="inserirEntrada" class="confirmarEntrada" onclick="cadastrarFinanceiro(event);"><i class="fas fa-plus-circle"></i></i> INSERIR</a>
                    <a href="javascript:;" id="editarEntradaFinanceiro" class="editarEntrada hidden" ><i class="fas fa-edit"></i></i> SALVAR</a>
                  </form>
                </div>
                <div id="resultadoPesquisaFinanceiro">
                  <h2>ÚLTIMOS REGISTROS FINANCEIROS INSERIDOS</h2>
                  <table id="my-table-financeiro" class="table tFinanceiro">
                    <thead>
                      <tr>
                        <th width="11%">Data</th>
                        <th >Empresa</th>
                        <th >Histórico</th>
                        <th width="11%"style="border-top-right-radius: 6px">N.F.</th>
                        <th width="1%" style="background-color: #F2F3E3!important; color:#F2F3E3"></th>
                        <th width="11%" style="border-top-left-radius: 6px; background-color: #0984e3">Crédito</th>
                        <th width="11%" style="background-color: #d63031">Débito</th>
                      </tr>
                    </thead>
                    <tbody id="containerFinanceiro1">
                      
                    </tbody>
                  </table>
                </div>

                <div id="resultadoFiltraPesquisaFinanceiro" class="hidden">
                    <h2>REGISTROS - <span id="nomeFiltraEmpresa">XXX</span></h2>
                    <table id="my-table-financeiro" class="table tFinanceiro">
                      <thead>
                        <tr>
                          <th width="11%">Data</th>
                          <th>Histórico</th>
                          <th width="11%" style="border-top-right-radius: 6px">N.F.</th>
                          <th width="1%" style="background-color: #F2F3E3; color:#F2F3E3"></th>
                          <th width="11%" style="border-top-left-radius: 6px; background-color: #0984e3">Crédito</th>
                          <th width="11%" style="background-color: #d63031">Débito</th>
                          <th width="5%" style="background-color:#636e72">Deletar</th>
                          <th width="5%" style="background-color:#636e72">Editar</th>
                        </tr>
                      </thead>
                      <tbody id="containerFinanceiro2">
                        
                      </tbody>
                    </table>
                  </div>
              </div>

              <div id="pageQualidadeAnalista" class="conteudoAba">
                <form id="" action="https://138.204.68.18:3323/controles/gallery" method="POST" enctype="multipart/form-data">
                  <div id="miniDashAnalista">
                      <h2>DOCUMENTOS DA QUALIDADE</h2>
                      <div id="empresaSelect">
                      <select name="acesso" id="select-empresa-controle-qualidade" onchange="fnPopulaControlesFornecedorQualidade();">
                          <option value="" data-placeholder>EMPRESA</option>
                      </select>
                      </div>
                      <select name="etapa" class="hidden" id="select-controle-qualidade" >
                        <option value="" data-placeholder >CONTROLES</option>
                      </select>
                      <select name="tipo-entrada" id="select-estagio-qualidade" onchange="guardaDados();">
                          <option value="" data-placeholder >ESTÁGIO</option>
                          <option value="Recepcao">RECEPÇÃO</option>
                          <option value="Selecao">SELEÇÃO</option>
                          <option value="Embalamento">EMBALAMENTO</option>
                          <option value="Expedicao">EXPEDIÇÃO</option>
                      </select>
                      <div class="btnAnexa">
                          <span>ANEXAR ARQUIVOS</span>
                          <input type="file" title="Anexar arquivos" multiple="">
                      </div>

                      <button class="confirmarUpload" id="btnApiStart" onclick="erroQualidade();"><i class="fas fa-cloud-upload-alt"></i> ENVIAR</button><br clear="all">
                      <div class="cardUpload">
                          <div class="cardHeader">
                            Lista de arquivos anexados
                          </div>
                        
                          <ul class="" id="files">
                            <li class="empty">Nenhum arquivo anexado</li>
                          </ul>
                      </div>

                  </div>
                  
                </form>
              </div>
            </div>
        </div>
      




        
        <script src="js/easydropdown.js"></script>
        <script type="text/javascript">
            function openModalDeleteRegistro(id) {
              document.getElementById('confirmarDelete').setAttribute('onclick','deletarRegistro("'+id+'")');
              document.getElementById('ModalDeleteRegistro').style.display = "block";
            }
            // Fecha modal delete user
            function closeModalDeleteRegistro() {
              document.getElementById('ModalDeleteRegistro').style.display = "none";
            }

            function openModalViewControle() {
              document.getElementById('ModalViewControle').style.display = "block";
            }
            // Fecha modal delete user
            function closeModalViewControle() {
              document.getElementById('ModalViewControle').style.display = "none";
            }

            function editRegistroFinanceiro(id, data, historico, nf, valor){
              console.log(id, data, historico, nf, valor)
              $('#input-descricao').focus();
              $('#titleFinanceiro').html("EDITAR REGISTRO");
              $('#titleFinanceiro').css("width","25%");
              $('#input-data').val(data);
              $('#input-descricao').val(historico);
              $('#input-nf').val(nf);
              $('#cancelaEdicao').removeClass('hidden');
              if(valor>=0){
                $('#input-valor').val(fnConvertValor(valor));
                $('#select-tipo-entrada').val(" ");
              }else{
                $('#input-valor').val(fnConvertValor(valor.substring(1,valor.length)));
                $('#select-tipo-entrada').val("-");
              }
              $('#inserirEntrada').addClass('hidden');
              $('#editarEntradaFinanceiro').removeClass('hidden');
              document.getElementById('editarEntradaFinanceiro').setAttribute('onclick','updateFinanceiro("'+id+'")');
            }
            
              $('#input-valor').mask('#.##0,00', {reverse: true});

            function limpaEditaFinanceiro(){
              $('#titleFinanceiro').html("INSERIR");
              $('#input-data').val("");
              $('#input-descricao').val("");
              $('#input-nf').val("");    
              $('#input-valor').val("");
              $('#titleFinanceiro').css("width","100%");         
              $('#inserirEntrada').removeClass('hidden');
              $('#editarEntradaFinanceiro').addClass('hidden');
              $('#cancelaEdicao').addClass('hidden');
              $('#select-tipo-entrada').val("");
            }

            function openModalComentario(id,texto,cod,controleCodigo) {
              document.getElementById('ModalComentario').style.display = "block";
              document.getElementById('comentario-Controle').value = texto;

              //recebendo nome da empresa
              document.getElementById('select-empresa-financeiro').value = cod;
              var e = document.getElementById('select-empresa-financeiro');
              var sel = e.options[e.selectedIndex].text;
              document.getElementById('controleCODcmt').innerHTML = sel;
              document.getElementById('select-empresa-financeiro').value = null;

              
              document.getElementById('controleCONcmt').innerHTML = controleCodigo.substring(0,controleCodigo.length-5);
              switch (controleCodigo.substring(controleCodigo.length - 4,controleCodigo.length - 3)) {
                case 'M':
                      document.getElementById('controleCULTURAcmt').innerHTML = "MANGA";
                  break;
                case 'U':
                      document.getElementById('controleCULTURAcmt').innerHTML = "UVA";
                  break;
                case 'C':
                     document.getElementById('controleCULTURAcmt').innerHTML = "CACAU";
                  break;
              }

              document.getElementById('controleSAFRAcmt').innerHTML = controleCodigo.substring(controleCodigo.length - 4,controleCodigo.length);

            }
            // Fecha modal Comentário
            function closeModalComentario() {
              document.getElementById('ModalComentario').style.display = "none";
            }
            


            function openCity(evt, cityName) {
              var i, tabcontent, tablinks;

              tabcontent = document.getElementsByClassName("conteudoAba");
              for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
              }
              tablinks = document.getElementsByClassName("tablinks");
              for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
              }
              document.getElementById(cityName).style.display = "block";
              evt.currentTarget.className += " active";
            }

            

            document.getElementById("default").click(); 




            const edd = easydropdown('#select-tipo-entrada');
            const edd2 = easydropdown('#select-estagio-qualidade');
            //const edd3 = easydropdown('#select-controle');
            


            async function erroImport(){
              //var checaInput = document.getElementById('input-controle').value;
              var checaControle = document.getElementById("input-controle").value;
              var checaAno = document.getElementById("select-ano-safra").value;
              var checaCultura = document.getElementById("select-cultura").value;
              var checaStatus = document.getElementById("select-status").value;

              if (checaControle == "" || checaAno == "" || checaCultura == "" || checaStatus == "" ){
                  
                  document.getElementById('erroImportData').innerHTML="Preencha todos os campos para iniciar a importação";
                  document.getElementById('erroImportData').style.display = "block";
                  setTimeout(function(){ document.getElementById('erroImportData').style.display = "none"; }, 4000);
              }else{
                  let codigo = checaControle+"-"+checaCultura+"-"+checaAno;
                  
                  let tokenStr = localStorage.getItem("token");
                  await axios.get(`http://138.204.68.18:3323/controles/${codigo}`,{ headers: {"Authorization" : `Bearer ${tokenStr}`} })
                  .then(function(response){
                    var controle = (response.data).controle;

                    if (controle.length==1 && controle[0].passoAtual == checaStatus && controle[0].visivel){
                      document.getElementById('erroImportData').innerHTML="Este controle já possui importação visível dessa etapa";
                      document.getElementById('erroImportData').style.display = "block";
                      setTimeout(function(){ document.getElementById('erroImportData').style.display = "none"; }, 4000);
                    }else if (controle.length==1 && controle[0].passoAtual == checaStatus){
                      document.getElementById('erroImportData').innerHTML="Este controle já possui importação para essa etapa verifique se deve tornar ela visivel";
                      document.getElementById('erroImportData').style.display = "block";
                      setTimeout(function(){ document.getElementById('erroImportData').style.display = "none"; }, 4000);
                    }else{
                      importarControle();
                    }
                  })
                  .catch(function(error){
                      console.warn(error);
                  });
                  
                  
                };
            }
            
            

                function erroQualidade(){
                  var qualidadeEmpresaControle = document.getElementById('select-empresa-controle-qualidade').value;
                  var qualidadeControle = document.getElementById("select-controle-qualidade").value;
                  var qualidadeEstagio = document.getElementById("select-estagio-qualidade").value;


                  if (qualidadeEmpresaControle == "" || qualidadeControle == "" || qualidadeEstagio == ""){
                      
                      document.getElementById('erroAdminQualidade').innerHTML="Preencha todos os campos para anexar os arquivos";
                      document.getElementById('erroAdminQualidade').style.display = "block";
                      setTimeout(function(){ document.getElementById('erroAdminQualidade').style.display = "none"; }, 4000);
                      
                  }else{
                    //evt.preventDefault();
                    $('.btnAnexa').dmUploader('start');
                    
                  };
                }
                
          
               
          
          $('#input-valor').mask('#.##0,00', {reverse: true});  
             
        </script>

        <script src="js/analista/analista.js"></script>
        
        <script src="js/jquery.dm-uploader.min.js"></script>
        <script src="js/control-uploader.js"></script>
        <script src="js/ui-multiple.js"></script>
        <script type="text/html" id="files-template">
          <li class="media">
            <div class="media-body">
              <p class="mb-2">
                <strong>%%filename%%</strong> - Status: <span class="text-muted">Aguardando</span>
              </p>
              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" 
                  role="progressbar"
                  style="width: 0%" 
                  aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                </div>
              </div>
              <hr class="mt-1 mb-1" />
            </div>
          </li>
        </script>
        <script src="js/vendor/jspdf.min.js"></script>
        <script src="js/vendor/jspdf.plugin.autotable.js"></script>
        
        
    </body>