<html>
    <head>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="js/vendor/jquery-1.7.2.min.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400, 500, 600, 700, 800, 900" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/ibacemj.css">
        <link rel="stylesheet" type="text/css" href="css/all.css" >
        <link rel="stylesheet" type="text/css" href="js/jquery.dynatable.css">
        <link rel="stylesheet" type="text/css" href="js/beanstalk.css">
        <link rel="stylesheet" type="text/css" href="js/jquery.dm-uploader.min.css">
        <link href="js/datepicker.css" rel="stylesheet" type="text/css">
        <script src="js/datepicker.js"></script>
        <script src="js/datepicker.pt-BR.js"></script>
        <script src="js/jquery.dynatable.js"></script>
        <script src="js/all.js"></script>
        
        

        <title>IBACEM - Sistema de Gerenciamento de Controles e Usuários</title>
        <meta charset="UTF-8">
    </head>
    <body>
        <!-- MODAL NOVO USUARIO -->
        <!-- MODAL NOVO USUARIO -->
        <!-- MODAL NOVO USUARIO -->
        <div id="ModalNovoUser" class="modal">
            <span class="close cursor" onclick="closeModalNovoUser();">&times;</span>
            <div class="modal-content">
                <h2>ADICIONAR NOVO USUÁRIO</h2>
                <form id="formCadastroUsuario" onsubmit="cadastrar(event);">
                    <fieldset>
                        <input type="text" placeholder="NOME COMPLETO" id="inputNome" autocomplete="name">
                        <input type="text" placeholder="E-MAIL" id="inputEmail" autocomplete="email">
                    </fieldset>
                    <fieldset>
                        <input type="password" placeholder="SENHA" id="inputSenha" autocomplete="new-password">
                        <input type="password" placeholder="CONFIRME SUA SENHA" id="inputSenha2" autocomplete="new-password">
                    </fieldset>
                    <fieldset>
                        <input type="text" placeholder="TELEFONE" id="inputTelefone" autocomplete="tel">
                        <select name="acesso" id="select-fidelidade">
                            <option value="" data-placeholder>FIDELIDADE</option>
                            <option value="1">SIM</option>
                            <option value="0">NÃO</option>
                        </select>
                    </fieldset>
                    <fieldset>
                        <select name="acesso" id="select-nivelAcesso" onchange="gambit();">
                            <option value="" data-placeholder>NÍVEL DE ACESSO</option>
                            <option value="Produtor">PRODUTOR</option>
                            <option value="Analista">ANALISTA</option>
                            <option value="Supervisor">SUPERVISOR</option>
                            <option value="Administrador">ADMINISTRADOR</option>
                        </select>
                        <div id="escondeCampo"></div>
                        <select name="acesso" id="select-empresa">
                            <option value="" data-placeholder>EMPRESA</option>
                        </select>
                    </fieldset>
                    <button class="cancelarUser" onclick="closeModalNovoUser();">CANCELAR</button> 
                    <button class="confirmarUser" type="submit">CONFIRMAR CADASTRO</button>
                    
                    
                </form>
                <br clear="all">
                <p id="mensagemErro"></p>
            </div>
        </div>
        <script>
          function gambit(){
              var e = document.getElementById("select-nivelAcesso");
              var strUser = e.options[e.selectedIndex].value;
              console.log(strUser);
              if(strUser == "Produtor"){
                document.getElementById("escondeCampo").style.display="none";
              }else{
                document.getElementById("escondeCampo").style.display="block";
              }
          }
        </script>







        <!-- MODAL DELETAR USUARIO -->
        <!-- MODAL DELETAR USUARIO -->
        <!-- MODAL DELETAR USUARIO -->
        <div id="ModalDeleteUser" class="modal">
            <span class="close cursor" onclick="closeModalDeleteUser();">&times;</span>
            <div class="modal-content2">
                <h2>CONFIRMAR AÇÃO</h2>
                <p>Deseja realmente deletar este usuário?<b> Essa ação não poderá ser desfeita</b></p>
                 <button id="confirmarDelete">SIM</button> <button class="cancelarDelete" onclick="closeModalDeleteUser();">CANCELAR</button>
                <br clear="all">
            </div>
        </div>


        <!--MODAL CONFIRMAR IMPORT-->
        <!--MODAL CONFIRMAR IMPORT-->
        <!--MODAL CONFIRMAR IMPORT-->
        <div id="ModalConfirmarImport" class="modal">
            <span class="close cursor" onclick="closeModalExibeImportacao();">&times;</span>
            <div class="modal-content3">
                <h2>CONFIRMAR IMPORTAÇÃO</h2>
                <div id="containerControles">
                    <ul>
                      <li>COD_FORNECEDOR: <span id="controleCOD" class="destacaImport">2</span></li>
                      <li>ANO: <span id="controleANO" class="destacaImport">2018</span></li>
                      <li>MÊS: <span id="controleMES" class="destacaImport">11</span></li>
                      <li>SEMANA: <span id="controleSEMANA" class="destacaImport">44</span></li>
                      <li>DATA: <span id="controleDATA" class="destacaImport">01/11/2018</span></li>
                      <li>CULTURA: <span id="controleCULTURA" class="destacaImport">Manga</span></li>
                      <li>VARIEDADE: <span id="controleVAR" class="destacaImport">TOMMY ATKINS</span></li>
                      <li>CONTROLE: <span id="controleCON" class="destacaImport">946</span></li>
                      <li>SAFRA: <span id="controleSAFRA" class="destacaImport">M18</span></li>
                      <li>VOLUME EM KG: <span id="controleCOD" class="destacaImport">8990</span></li>
                    </ul>
                </div>
                 <button id="confirmarImport" onclick="salvaControle();">SIM</button> <button class="cancelarDelete" onclick="closeModalExibeImportacao();">CANCELAR</button>
                <br clear="all">
            </div>
        </div>


        <header>
            <div class="wrapper">
                <h1>Ibacem</h1>
                <div id="userInfo">
                    <!-- img src="img/user.webp"-->
                    <p>Olá, <span id="userName"></span></p>
                    <a id="logoff" href="javascript:;" onclick="sair();">SAIR</a>
                </div>
            </div>
        </header>
        <div id="menuHolder" >
            <div id="abas">
                <button class="tablinks" onclick="openCity(event, 'pageControles')" id="default">CONTROLES</button>
                <button class="tablinks" onclick="openCity(event, 'pageUsuarios')">USUÁRIOS</button>
                <button class="tablinks" onclick="openCity(event, 'pageFinanceiroAdmin')">FINANCEIRO</button>
                <button class="tablinks" onclick="openCity(event, 'pageQualidadeAdmin')">QUALIDADE</button>
            </div>
        </div>


        <div class="wrapper">
            <div id="pageControles" class="conteudoAba">
                <div id="importDataArea">
                    <h2>IMPORTAR CONTROLE</h2>
                    <input id="input-controle" type="text" placeholder="CONTROLE" value="">
                    
                    <select name="ano-safra" id="select-ano-safra">
                        <option value="" data-placeholder>ANO</option>
                        <option value="17">2017</option>
                        <option value="18">2018</option>
                        <option value="19">2019</option>
                    </select>
                    <select name="cultura" id="select-cultura">
                        <option value="" data-placeholder>CULTURA</option>
                        <option value="M">Manga</option>
                        <option value="U">Uva</option>
                        <option value="C">Cacau</option>
                    </select>
                    <select name="status" id="select-status">
                        <option value="" data-placeholder>STATUS</option>
                        <option value="Recepção">Recepção</option>
                        <option value="Seleção">Seleção</option>
                        <option value="Embalagem">Embalagem</option>
                        <option value="Expedição">Expedição</option>
                        <option value="Comercial">Comercial</option>
                    </select>
                    <button class="importDataControles" onclick="erroImport();"><i class="fas fa-plus-circle"></i> IMPORTAR</button>
                    <p id="erroImportData"></p>
                </div>

                <div class="tableHolder">
                    <h2>ÚLTIMOS CONTROLES IMPORTADOS</h2>
                    <table id="my-table" class="table tControles">
                      <thead>
                        <tr>
                          <th width="15%">Controle</th>
                          <th width="17%">Data de importação</th>
                          <th>Status</th>
                          <th>Importador</th>
                          <th>Supervisor</th>
                          <th width="9%">Analisado</th>
                          <th width="7%">Público</th>
                        </tr>
                      </thead>
                      <tbody id="tbody-controles">
                      </tbody>
                    </table>
                </div>
            </div>

            <div id="pageUsuarios" class="conteudoAba">
              <div id="gerenciarUsers">
                <h2>CRIAR USUÁRIO</h2>
                <button class="criarUser" onclick="openModalNovoUser();"><i class="fas fa-plus-circle"></i> NOVO USUÁRIO</button>
              </div>

              <div class="tableHolder">
                <h2>USUÁRIOS CADASTRADOS</h2>
                <table id="my-table-user" class="table tUsuarios">
                  <thead>
                    <tr>
                      <th width="45%">Produtor</th>
                      <th width="15%">Usuário</th>
                      <th width="13%">Categoria</th>
                      <th>E-mail</th>
                      <th width="7%">Deletar</th>
                    </tr>
                  </thead>
                  <tbody id="tbody-user">
                  </tbody>
                </table>
              </div>
            </div>







            <div id="pageFinanceiroAdmin" class="conteudoAba">
              
              <div id="pesquisaFinanceira">
                <h2>FILTRAR POR EMPRESA</h2>
                <select name="acesso" id="select-empresa-financeiro" onchange="filtraEmpresa();">
                    <option value="" data-placeholder>EMPRESA</option>
                </select>
                <button class="confirmarPesquisa" onclick="filtraEmpresa();">FILTRAR</button>
              </div>
              <div id="entradaFinanceira" class="hidden">
                  <h2>INSERIR</h2>
                  <form id="formEntFinanceira" onsubmit="cadastrarFinanceiro(event);">
                    <input id="input-data" type="text" placeholder="DATA" value="" class="datepicker-here" data-language='pt-BR'>
                    <input id="input-descricao" type="text" placeholder="DESCRIÇÃO" value="">
                    <input id="input-valor" type="text" placeholder="VALOR" value="">
                    <select name="tipo-entrada" id="select-tipo-entrada">
                        <option value="x" data-placeholder >MOVIMENTAÇÃO</option>
                        <option value=" ">CRÉDITO</option>
                        <option value="-">DÉBITO</option>
                    </select>
                    <button class="confirmarEntrada" type="submit" ><i class="fas fa-plus-circle"></i></i> INSERIR</button>
                  </form>
                </div>
                <div id="resultadoPesquisaFinanceiro">
                  <h2>REGISTROS FINANCEIROS NÃO APROVADOS</h2>
                  <table id="my-table-financeiro" class="table tFinanceiro">
                    <thead>
                      <tr>
                        <th width="11%">Data</th>
                        <th >Empresa</th>
                        <th style="border-top-right-radius: 6px">Histórico</th>
                        <th width="1%" style="background-color: #F2F3E3; color:#F2F3E3">0</th>
                        <th width="11%" style="border-top-left-radius: 6px; background-color: #0984e3">Crédito</th>
                        <th width="11%" style="background-color: #d63031">Débito</th>
                        <th width="11%" style="background-color: #636e72">Aprovado</th>
                      </tr>
                    </thead>
                    <tbody id="containerFinanceiro1">
                      
                    </tbody>
                  </table>
                </div>

                <div id="resultadoFiltraPesquisaFinanceiro" class="hidden">
                    <h2>REGISTROS - <span id="nomeFiltraEmpresa">XXX</span></h2>
                    <table id="my-table-financeiro" class="table tFinanceiro">
                      <thead>
                        <tr>
                          <th width="11%">Data</th>
                          <th style="border-top-right-radius: 6px">Histórico</th>
                          <th width="1%" style="background-color: #F2F3E3; color:#F2F3E3">0</th>
                          <th width="11%" style="border-top-left-radius: 6px; background-color: #0984e3">Crédito</th>
                          <th width="11%" style="background-color: #d63031">Débito</th>
                          <th width="8%" style="background-color:#636e72">Deletar</th>
                        </tr>
                      </thead>
                      <tbody id="containerFinanceiro2">
                        
                      </tbody>
                    </table>
                  </div>
              </div>









            <div id="pageQualidadeAdmin" class="conteudoAba">
              <form id="" action="https://138.204.68.18:3323/controles/gallery" method="POST" enctype="multipart/form-data">
                <div id="miniDashAnalista">
                    <h2>DOCUMENTOS DA QUALIDADE</h2>
                    <p id="erroAdminQualidade" class="erroRangeData"></p><br>
                    <div id="empresaSelect">
                      <select name="acesso" id="select-empresa-controle" onchange="fnPopulaControlesFornecedor();">
                          <option value="" data-placeholder>EMPRESA</option>
                      </select>
                    </div>
                    <select name="etapa" class="hidden" id="select-controle" >
                      <option value="" data-placeholder >CONTROLES</option>
                    </select>
                    <select name="tipo-entrada" id="select-estagio-qualidade" onchange="guardaDados();">
                        <option value="" data-placeholder >ESTÁGIO</option>
                        <option value="Recepcao">RECEPÇÃO</option>
                        <option value="Selecao">SELEÇÃO</option>
                        <option value="Embalamento">EMBALAMENTO</option>
                        <option value="Expedicao">EXPEDIÇÃO</option>
                    </select>
                    <div class="btnAnexa">
                        <span>ANEXAR ARQUIVOS</span>
                        <input type="file" title="Anexar arquivos" multiple="">
                    </div>

                    <button class="confirmarUpload" id="btnApiStartAdmin" onclick="erroQualidade();"><i class="fas fa-cloud-upload-alt"></i> ENVIAR</button><br clear="all">
                    <div class="cardUpload">
                        <div class="cardHeader">
                          Lista de arquivos anexados
                        </div>
                      
                        <ul class="" id="files">
                          <li class="empty">Nenhum arquivo anexado</li>
                        </ul>
                    </div>

                </div>
                
              </form>
            </div>

      </div>





        <script type="text/javascript">
            function filtraEmpresa(){
              var empresaFiltra = document.getElementById("select-empresa-financeiro").options[document.getElementById('select-empresa-financeiro').selectedIndex].innerText;


              document.getElementById("entradaFinanceira").style.display = "block";
              document.getElementById("resultadoFiltraPesquisaFinanceiro").style.display = "block";
              document.getElementById("resultadoPesquisaFinanceiro").style.display = "none";
              document.getElementById("nomeFiltraEmpresa").innerHTML = empresaFiltra;

              fnPopulaFinanceirosFornecedor();
            }



            function openCity(evt, cityName) {
              
              var i, tabcontent, tablinks;

              
              tabcontent = document.getElementsByClassName("conteudoAba");
              for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
              }

              
              tablinks = document.getElementsByClassName("tablinks");
              for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
              }

              
              document.getElementById(cityName).style.display = "block";
              evt.currentTarget.className += " active";
            }
            document.getElementById("default").click();
            
        </script>
        
        <script src="js/easydropdown.js"></script>
        <script src="js/admin/admin.js"></script>
        <script>
            const edd = easydropdown('#select-ano-safra');
            const edd2 = easydropdown('#select-cultura');
            const edd3 = easydropdown('#select-status');
            const edd4 = easydropdown('#select-tipo-entrada');

            jQuery(document).ready(function($) {
                $('#my-table').dynatable({
                  features: {
                    paginate: false,
                    sort: false,
                    pushState: false,
                    search: false,
                    recordCount: false,
                    perPageSelect: false
                  }
                });
                $('#my-table-user').dynatable({
                  features: {
                    paginate: false,
                    sort: false,
                    pushState: false,
                    search: false,
                    recordCount: false,
                    perPageSelect: false
                  }
                });
                fnPopulaControles(); 
                fnPopulaUsuarios();
                fnPopulaEmpresas();
                $('#input-data').datepicker({
                    language: 'pt-BR',
                    maxDate: new Date()
                })

            });
            function openModalDeleteUser(id) {
              document.getElementById('confirmarDelete').setAttribute('onclick','deletarUsuario("'+id+'")');
              document.getElementById('ModalDeleteUser').style.display = "block";
            }
            // Abre modal novo user
            function openModalNovoUser() {
              document.getElementById('ModalNovoUser').style.display = "block";
              fnPopulaEmpresas();
            }
            // Fecha modal novo user
            function closeModalNovoUser() {
              document.getElementById('ModalNovoUser').style.display = "none";
            }
            // Fecha modal delete user
            function closeModalDeleteUser() {
              document.getElementById('ModalDeleteUser').style.display = "none";
            }
            // Abre modal exibe importação
            function openModalExibeImportacao() {
              document.getElementById('ModalConfirmarImport').style.display = "block";
            }
            // Fecha modal exibe importação
            function closeModalExibeImportacao() {
              document.getElementById('ModalConfirmarImport').style.display = "none";
            }
            function erroImport(){
              var checaInput = document.getElementById('input-controle').value;
              var checaControle = document.getElementById("input-controle").value;
              var checaAno = document.getElementById("select-ano-safra").value;
              var checaCultura = document.getElementById("select-cultura").value;
              var checaStatus = document.getElementById("select-status").value;

              if (checaInput == "" || checaControle == "" || checaAno == "" || checaCultura == "" || checaStatus == "" ){
                  
                  document.getElementById('erroImportData').innerHTML="Preencha todos os campos para iniciar a importação";
                  document.getElementById('erroImportData').style.display = "block";
                  setTimeout(function(){ document.getElementById('erroImportData').style.display = "none"; }, 4000);
                }else{
                  importarControle();
                };
            }
            function erroQualidade(){
              var qualidadeEmpresaControle = document.getElementById('select-empresa-controle').value;
              var qualidadeControle = document.getElementById("select-controle").value;
              var qualidadeEstagio = document.getElementById("select-estagio-qualidade").value;


              if (qualidadeEmpresaControle == "" || qualidadeControle == "" || qualidadeEstagio == ""){
                  
                  document.getElementById('erroAdminQualidade').innerHTML="Preencha todos os campos para anexar os arquivos";
                  document.getElementById('erroAdminQualidade').style.display = "block";
                  setTimeout(function(){ document.getElementById('erroAdminQualidade').style.display = "none"; }, 4000);
                  
                }else{
                  evt.preventDefault();
                  $('.btnAnexa').dmUploader('start');
                  console.log("entrou");
                };
            }
            
    


              (function($, undefined) {

                "use strict";

                // When ready.
                $(function() {
                    
                    var $form = $( "#formEntFinanceira" );
                    var $input = $form.find( "#input-valor" );

                    $input.on( "keyup", function( event ) {
                        
                        
                        // When user select text in the document, also abort.
                        var selection = window.getSelection().toString();
                        if ( selection !== '' ) {
                            return;
                        }
                        
                        // When the arrow keys are pressed, abort.
                        if ( $.inArray( event.keyCode, [38,40,37,39] ) !== -1 ) {
                            return;
                        }
                        
                        
                        var $this = $( this );
                        
                        // Get the value.
                        var input = $this.val();
                        var input = input.replace(/[\D\s\._\-]+/g, "");
                                input = input ? parseInt( input, 10 ) : 0;

                                $this.val( function() {
                                    return ( input === 0 ) ? "" : input.toLocaleString( "pt-BR" );
                                } );
                    } );
                    
                    /**
                     * ==================================
                     * When Form Submitted
                     * ==================================
                     */
                    $form.on( "submit", function( event ) {
                        
                        var $this = $( this );
                        var arr = $this.serializeArray();
                    
                        for (var i = 0; i < arr.length; i++) {
                                arr[i].value = arr[i].value.replace(/[($)\s\._\-]+/g, ''); // Sanitize the values.
                        };
                        
                        console.log( arr );
                        
                        event.preventDefault();
                    });
                    
                });
                })(jQuery);



        </script>
        <script src="js/jquery.dm-uploader.min.js"></script>
        <script src="js/control-uploader.js"></script>
        <script src="js/ui-multiple.js"></script>
        <script type="text/html" id="files-template">
          <li class="media">
            <div class="media-body">
              <p class="mb-2">
                <strong>%%filename%%</strong> - Status: <span class="text-muted">Aguardando</span>
              </p>
              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" 
                  role="progressbar"
                  style="width: 0%" 
                  aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                </div>
              </div>
              <hr class="mt-1 mb-1" />
            </div>
          </li>
        </script>
        

    </body>